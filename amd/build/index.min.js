define(["jquery","local_customreportuv/sweetalert","local_customreportuv/FileSaver"],function(a,b){return{init:function(){function c(b){require(["xlsx"],function(c){var e=c.utils.book_new(),f=a("#course").text(),i=Date.now();e.Props={Title:f,Subject:"Reporte notas",Author:"Campus Virtual Univalle",CreatedDate:i},console.log(b);var j=0;b.forEach(function(a){console.log(a);var b=h[j].substr(0,31);if(e.SheetNames.push(b),0==a.length){ws_data=[["No se encuentran calificaciones en este item"]];var d=c.utils.aoa_to_sheet(ws_data)}else var d=c.utils.json_to_sheet(a);e.Sheets[b]=d,console.log(e),j++});var k=c.write(e,{bookType:"xlsx",type:"binary"}),l=f+".xlsx";saveAs(new Blob([d(k)],{type:"application/octet-stream"}),l),g=[],h=[]})}function d(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=255&a.charCodeAt(d);return b}function e(){for(var a=window.location.search.split("="),b=0;b<a.length;b+=2)if("?id"==a[b])var c=a[b+1];return c}var f=!0,g=[],h=[];a("#sel").click(function(){a('[type="checkbox"]').each(function(){f?a(this).attr("checked",!1):a(this).attr("checked",!0)}),f=!f,g=[]}),a("#download").click(function(){a('[type="checkbox"]').each(function(){a(this).prop("checked")&&(g.push(a(this).val()),h.push(a(this).parent().text().trim().split("(")[0]))}),0==g.length?b("Error","Seleccione al menos un item de calificacion a exportar","warning"):a.ajax({type:"POST",data:{data:g,course:e()},url:"managers/ajax_processing.php",success:function(a){c(a)},dataType:"json",cache:"false",error:function(a){g=[],b("Server Error",a.error,"error"),console.log("AJAXerror"),console.log(a)}})})}}});